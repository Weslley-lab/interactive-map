<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Mapa Interativo</title>
  <link rel="icon" href="icon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="toolbar">
    <button id="newProject">ğŸ†• Novo Projeto</button>
    <button id="openProject" data-tooltip="Ctrl+O">ğŸ“‚ Abrir Projeto</button>
    <button id="saveProject" data-tooltip="Ctrl+S">ğŸ’¾ Salvar Projeto</button>
    <button id="openImage" data-tooltip="Ctrl+I">ğŸ–¼ï¸ Abrir Imagem</button>
    <button id="exportPNG" data-tooltip="Ctrl+E">ğŸ“¤ Exportar Imagem</button>

    <!-- Menu Marcadores (Forma + Borda) -->
    <div style="position:relative;">
      <button id="markerMenuBtn" class="small" data-tooltip="M">ğŸ“ Marcadores â–¾</button>
      <div id="markerMenu" class="popup-menu hidden" style="left:0;">
        <div class="popup-title">Marcadores</div>

        <div class="popup-section-title">Forma</div>
        <div class="shape-row">
<button class="shape-option" data-shape-option="circle">
<span class="shape-icon">âšª</span>
</button>
<button class="shape-option" data-shape-option="square">
<span class="shape-icon">â¬œ</span>
</button>
<button class="shape-option" data-shape-option="triangle">
<span class="shape-icon">â–²</span>
</button>
<button class="shape-option" data-shape-option="cross">
<span class="shape-icon">âœš</span>
</button>
<button class="shape-option" data-shape-option="question">
<span class="shape-icon">?</span>
</button>
</div>
<div class="shape-row">
<button class="shape-option" data-shape-option="diamond">
<span class="shape-icon">â—†</span>
</button>
<button class="shape-option" data-shape-option="hexagon">
<span class="shape-icon">â¬Ÿ</span>
</button>
<button class="shape-option" data-shape-option="star">
<span class="shape-icon">â˜…</span>
</button>
<button class="shape-option" data-shape-option="pentagon">
<span class="shape-icon">â¬˜</span>
</button>
<button class="shape-option" data-shape-option="heptagon">
<span class="shape-icon">â¬£</span>
</button>
</div>
<div class="popup-field">
<label>Tamanho:
            <input id="size" max="200" min="2" style="width:70px" type="number" value="10"/>
</label>
</div>
<div class="popup-field">
<label>Opacidade:
            <input id="opacity" max="1" min="0.1" step="0.05" type="range" value="1"/>
</label>
</div>
<div class="popup-field">
<label>Cor de preenchimento:
            <input id="color" type="color" value="#ff0000"/>
</label>
</div>
<div class="popup-field">
<label>Preenchimento:
            <select id="fillType" style="width:140px">
<option value="solid">Cor sÃ³lida</option>
<option value="none">Sem preenchimento</option>
</select>
</label>
</div>
<input id="shape" type="hidden" value="circle"/>

        <div class="popup-divider"></div>
        <div class="popup-section-title">Borda</div>
        <div class="popup-field">
<label>Cor:
            <input id="borderColor" type="color" value="#222222"/>
</label>
</div>
<div class="popup-field">
<label>Espessura:
            <input id="borderWidth" max="20" min="0" style="width:70px" type="number" value="2"/>
</label>
</div>
<div class="popup-field">
<label>
<input id="borderNone" type="checkbox"/> Sem borda
          </label>
</div>
      </div>
    </div>

    <!-- Presets / Hotkeys -->
    <div class="preset-bar">
      <span style="font-size:12px;opacity:0.8;">Presets:</span>

      <div class="preset-slot" data-slot="0">
        <button class="preset-btn" id="preset0Btn" data-tooltip="1">
          <canvas id="preset0Canvas" width="40" height="32"></canvas>
        </button>
        <div class="preset-side">
          <button class="preset-add" id="preset0Save">+</button>
          <button class="preset-reset" id="preset0Clear">âˆ’</button>
        </div>
      </div>

      <div class="preset-slot" data-slot="1">
        <button class="preset-btn" id="preset1Btn" data-tooltip="2">
          <canvas id="preset1Canvas" width="40" height="32"></canvas>
        </button>
        <div class="preset-side">
          <button class="preset-add" id="preset1Save">+</button>
          <button class="preset-reset" id="preset1Clear">âˆ’</button>
        </div>
      </div>

      <div class="preset-slot" data-slot="2">
        <button class="preset-btn" id="preset2Btn" data-tooltip="3">
          <canvas id="preset2Canvas" width="40" height="32"></canvas>
        </button>
        <div class="preset-side">
          <button class="preset-add" id="preset2Save">+</button>
          <button class="preset-reset" id="preset2Clear">âˆ’</button>
        </div>
      </div>

      <div class="preset-slot" data-slot="3">
        <button class="preset-btn" id="preset3Btn" data-tooltip="4">
          <canvas id="preset3Canvas" width="40" height="32"></canvas>
        </button>
        <div class="preset-side">
          <button class="preset-add" id="preset3Save">+</button>
          <button class="preset-reset" id="preset3Clear">âˆ’</button>
        </div>
      </div>
    </div>

    <div style="margin-left:auto; position:relative; display:flex; align-items:center; gap:6px;">
      <button id="settingsBtn" class="small" data-tooltip="ConfiguraÃ§Ãµes">âš™ï¸</button>
      <button id="shortcutsBtn" class="small" data-tooltip="Ajuda">ğŸ†˜</button>
      <div id="settingsBox" class="popup-menu hidden" style="right:0;">
        <div class="popup-title">ConfiguraÃ§Ãµes</div>
        <div class="popup-field">
          <label>Tema:
            <select id="themeSelect" style="width:100%;">
              <option value="dark">Escuro</option>
              <option value="light">Claro</option>
                          <option value="cristal">Cristal</option>
              <option value="cristal-dark">Aurora</option>              
			  <option value="terminal">Terminal</option>
              <option value="aurora">Terra</option>

</select>
          </label>
        </div>
        <div class="popup-divider"></div>
        <button id="bgEditBtn" class="popup-action" type="button">Editar imagem de fundo</button>
      </div>


<div id="shortcutsBox" class="popup-menu hidden" style="right:0;">
        <div class="popup-title">Atalhos</div>
        <div class="popup-field"><b>BotÃ£o esquerdo</b> â€” Criar marcador</div>
        <div class="popup-field"><b>BotÃ£o direito</b> â€” Remover marcador</div>
        <div class="popup-field"><b>Arrastar esquerdo</b> â€” Mover imagem (pan)</div>
        <div class="popup-field"><b>BotÃ£o do meio sobre marcador</b> â€” Mover marcador</div>
        <div class="popup-field"><b>Scroll do mouse</b> â€” Zoom</div>
        <hr style="border:0;border-top:1px solid rgba(255,255,255,0.1);margin:6px 0" />
        <div class="popup-field"><b>Ctrl + O</b> â€” Abrir projeto</div>
        <div class="popup-field"><b>Ctrl + I</b> â€” Abrir imagem</div>
        <div class="popup-field"><b>Ctrl + S</b> â€” Salvar projeto</div>
        <div class="popup-field"><b>Ctrl + E</b> â€” Exportar PNG</div>
        <div class="popup-field"><b>Ctrl + Z</b> â€” Desfazer</div>
        <div class="popup-field"><b>1, 2, 3 e 4</b> â€” Selecionar preset</div>
        <div class="popup-field"><b>M</b> â€” Marcadores</div>
      </div>
    </div>
  </div>

  <input type="file" id="fileImage" accept="image/*" hidden />
  <input type="file" id="fileProject" accept="application/json" hidden />

  <canvas id="canvas"></canvas>

  <!-- Modal de confirmaÃ§Ã£o de saÃ­da -->
  <div id="exitModal" class="modal-backdrop hidden">
    <div class="modal-content">
      <div class="modal-title">Sair do aplicativo</div>
      <div class="modal-text">Deseja salvar o projeto antes de sair?</div>
      <div class="modal-actions">
        <button id="exitSaveBtn">ğŸ’¾ Salvar e sair</button>
        <button id="exitWithoutSaveBtn">âï¸ Sair sem salvar</button>
        <button id="exitCancelBtn">Cancelar</button>
      </div>
    </div>
  </div>


  <!-- Modal: editar imagem de fundo -->
  <div id="bgAdjustModal" class="modal-backdrop hidden">
    <div class="modal-content" style="max-width: 560px;">
      <div class="modal-title"><b>Editar imagem de fundo</b></div>
      <div class="bg-adjust-grid">
        <div class="bg-adjust-row">
          <label>Brilho <span id="bgAdjBrightnessVal" class="val">100%</span></label>
          <input id="bgAdjBrightness" class="range-center" type="range" min="50" max="150" step="1" value="100" />
        </div>

        <div class="bg-adjust-row">
          <label>Contraste <span id="bgAdjContrastVal" class="val">100%</span></label>
          <input id="bgAdjContrast" class="range-center" type="range" min="50" max="150" step="1" value="100" />
        </div>

        <div class="bg-adjust-row">
          <label>SaturaÃ§Ã£o <span id="bgAdjSaturationVal" class="val">100%</span></label>
          <input id="bgAdjSaturation" class="range-center" type="range" min="0" max="200" step="1" value="100" />
        </div>

        <div class="bg-adjust-row">
          <label>Matiz <span id="bgAdjHueVal" class="val">0Â°</span></label>
          <input id="bgAdjHue" class="range-center" type="range" min="-180" max="180" step="1" value="0" />
        </div>

        <div class="bg-adjust-row">
          <label>Desfoque <span id="bgAdjBlurVal" class="val">0.0px</span></label>
          <input id="bgAdjBlur" class="range-center" type="range" min="0" max="10" step="0.1" value="0" />
        </div>

        <div class="bg-adjust-row">
          <label>Escala de cinza <span id="bgAdjGrayscaleVal" class="val">0%</span></label>
          <input id="bgAdjGrayscale" class="range-center" type="range" min="0" max="100" step="1" value="0" />
        </div>
      </div>

      <div class="modal-actions">
        <button id="bgAdjResetBtn"><b>Resetar</b></button>
        <button id="bgAdjCloseBtn"><b>Aplicar</b></button>
      </div>
    </div>
  </div>


    <script src="renderer.js"></script>
  <script>
    const markerMenuBtn = document.getElementById("markerMenuBtn");
    const markerMenu = document.getElementById("markerMenu");
    const shortcutsBtn = document.getElementById("shortcutsBtn");
    const shortcutsBox = document.getElementById("shortcutsBox");
    const settingsBtn = document.getElementById("settingsBtn");
    const settingsBox = document.getElementById("settingsBox");

function closeAllMenus() {
      if (markerMenu) markerMenu.classList.add("hidden");
      if (shortcutsBox) shortcutsBox.classList.add("hidden");
      if (settingsBox) settingsBox.classList.add("hidden");
    }

    function toggleMenu(menu) {
      if (!menu) return;
      const willShow = menu.classList.contains("hidden");
      closeAllMenus();
      if (willShow) {
        menu.classList.remove("hidden");
      }
    }

    markerMenuBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleMenu(markerMenu);
    });

    shortcutsBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleMenu(shortcutsBox);
    });

    

    settingsBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleMenu(settingsBox);
    });
document.addEventListener("click", (e) => {
      const t = e.target;
      if (
        markerMenuBtn && markerMenu &&
        !markerMenuBtn.contains(t) && !markerMenu.contains(t) &&
        shortcutsBtn && shortcutsBox &&
        !shortcutsBtn.contains(t) && !shortcutsBox.contains(t) &&
        settingsBtn && settingsBox &&
        !settingsBtn.contains(t) && !settingsBox.contains(t)
      ) {
        closeAllMenus();
      }
    });

  </script>
</body>
</html>
